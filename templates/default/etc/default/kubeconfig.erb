apiVersion: v1
knid: Config
clusters:
<%
unless @clusters.nil?
  @clusters.each do |cluster| %>
- cluster:
<%  unless cluster.ca.nil? %>
    certificate-authority: <%= cluster.ca %>
<%  end
    unless cluster.server.nil? %>
    server: <%= cluster.server %>
<%  end
    unless cluster.skip_tls_verify.nil? %>
    insecure-skip-tls-verify: <%= cluster.skip_tls_verify %>
<%  end
    unless cluster.name.nil? %>
  name: <%= cluster.name %>
<%
    end
  end
end %>

    server: <%= @server %>
  name: kubernetes-cluster
users:
- name: kubernetes-user
  user:
    client-certificate: <%= @cert %>
    client-key: <%= @key %>
contexts:
- context:
    cluster: kubernetes-cluster
    user: kubernetes-user
  name: kubernetes
current-context: kubernetes




apiVersion: v1
knid: Config
clusters:
- cluster:
    certificate-authority: <%= @ca %>
    server: <%= @server %>
  name: kubernetes-cluster
users:
- name: kubernetes-user
  user:
    client-certificate: <%= @cert %>
    client-key: <%= @key %>
contexts:
- context:
    cluster: kubernetes-cluster
    user: kubernetes-user
  name: kubernetes
current-context: kubernetes
